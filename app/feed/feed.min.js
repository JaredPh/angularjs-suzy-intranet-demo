!function(t){"use strict";t.module("es.feed",["es.news","es.page","es.widgets","ngCookies","ngSanitize","ui.router"]).config(["$stateProvider","$urlRouterProvider","$locationProvider",function(t,e,a){t.state("feed",{url:"/feed/",templateUrl:"app/feed/feed.main.html",data:{label:"Feed"}}).state("feed.tag",{url:":tag",templateUrl:"app/feed/feed.tag.html",data:{label:"@tag"}})}]).directive("feed",[function(){return{restrict:"E",replace:!0,scope:{tag:"="},templateUrl:"app/feed/feed.html",controller:["$scope","$filter","$state","$stateParams","NewsFactory",function(e,a,r,o,i){i.getNewsStories().then(function(i){var n=[];t.forEach(i,function(t,e,a){if(t.type="news",o.hasOwnProperty("tag")){for(var r in t.tags)if(t.tags[r].toLowerCase()===o.tag.toLowerCase().replace(/_/g," ")){this.push(t);break}}else this.push(t)},n);var s={id:"POLL0001",type:"widget",widget:"poll",date:1459780428126,title:"Reigate DDD Charity",body:"Which Charity would you like to support on Dress Down Day this Friday?",tags:["Reigate","Internal Comms"],options:["Clifton High School","Delight"]};e.feedItems=a("orderBy")(n,"date",!0),"home"===r.current.name&&e.feedItems.splice(1,0,{type:"widget",widget:"weather"},{type:"widget",widget:"stock"}),e.feedItems.splice(3,0,s)}),e.showMore=function(){e.pattern=e.pattern.concat(e.additionalPattern)}}],link:function(t,e,a){var r=a.pattern.split("-");t.pattern=r[0].split(""),t.additionalPattern=1===r.length?r[0].split(""):r[1].split("")}}}]).directive("feedItem",["$compile",function(t){return{restrict:"EA",replace:!0,scope:{item:"="},controller:["$scope","$filter","NewsFactory",function(t,e,a){}],link:function(e,a,r){var o="";switch(e.item.type){case"news":o='<news:preview data-article="item"></news:test>';break;case"widget":o="<widget:"+e.item.widget+' poll="item"></widget:'+e.item.widget+">";break;default:o="<p>Not Found - ("+e.item.type+")</p>"}a.html(o).show(),t(a.contents())(e)}}}]).directive("tags",["$compile",function(t){return{restrict:"E",replace:!0,scope:{tags:"=tagList",add:"="},templateUrl:"app/feed/feed.tagList.html",controller:["$scope","$state",function(t,e){t.getTagClasses=function(t){return{location:null!==t.match(/(glasgow)|(manchester)|(reigate)/i)}},t.goToFeed=function(a,r){a.stopPropagation(),t.add||e.go("feed.tag",{tag:r.replace(/\s/g,"_")})}}]}}])}(window.angular);
