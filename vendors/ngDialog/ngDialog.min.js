!function(e,t){"undefined"!=typeof module&&module.exports?(t("undefined"==typeof angular?require("angular"):angular),module.exports="ngDialog"):"function"==typeof define&&define.amd?define(["angular"],t):t(e.angular)}(this,function(e){"use strict";var t=e.module("ngDialog",[]),n=e.element,r=e.isDefined,i=(document.body||document.documentElement).style,a=r(i.animation)||r(i.WebkitAnimation)||r(i.MozAnimation)||r(i.MsAnimation)||r(i.OAnimation),o="animationend webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend",s="a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]",u="ngdialog-disabled-animation",l={html:!1,body:!1},c={},m=[],d=!1,f=!1;return t.provider("ngDialog",function(){var t=this.defaults={className:"ngdialog-theme-default",disableAnimation:!1,plain:!1,showClose:!0,closeByDocument:!0,closeByEscape:!0,closeByNavigation:!1,appendTo:!1,preCloseCallback:!1,overlay:!0,cache:!0,trapFocus:!0,preserveFocus:!0,ariaAuto:!0,ariaRole:null,ariaLabelledById:null,ariaLabelledBySelector:null,ariaDescribedById:null,ariaDescribedBySelector:null};this.setForceHtmlReload=function(e){l.html=e||!1},this.setForceBodyReload=function(e){l.body=e||!1},this.setDefaults=function(n){e.extend(t,n)},this.setOpenOnePerName=function(e){f=e||!1};var r,i=0,p=0,h={};this.$get=["$document","$templateCache","$compile","$q","$http","$rootScope","$timeout","$window","$controller","$injector",function(g,v,b,y,$,w,x,C,j,S){var D=[],A={onDocumentKeydown:function(e){27===e.keyCode&&k.close("$escape")},activate:function(e){var t=e.data("$ngDialogOptions");t.trapFocus&&(e.on("keydown",A.onTrapFocusKeydown),D.body.on("keydown",A.onTrapFocusKeydown))},deactivate:function(e){e.off("keydown",A.onTrapFocusKeydown),D.body.off("keydown",A.onTrapFocusKeydown)},deactivateAll:function(t){e.forEach(t,function(t){var n=e.element(t);A.deactivate(n)})},setBodyPadding:function(e){var t=parseInt(D.body.css("padding-right")||0,10);D.body.css("padding-right",t+e+"px"),D.body.data("ng-dialog-original-padding",t),w.$broadcast("ngDialog.setPadding",e)},resetBodyPadding:function(){var e=D.body.data("ng-dialog-original-padding");e?D.body.css("padding-right",e+"px"):D.body.css("padding-right",""),w.$broadcast("ngDialog.setPadding",0)},performCloseDialog:function(e,t){var n=e.data("$ngDialogOptions"),i=e.attr("id"),s=c[i];if(s){if("undefined"!=typeof C.Hammer){var u=s.hammerTime;u.off("tap",r),u.destroy&&u.destroy(),delete s.hammerTime}else e.unbind("click");1===p&&D.body.unbind("keydown",A.onDocumentKeydown),e.hasClass("ngdialog-closing")||(p-=1);var l=e.data("$ngDialogPreviousFocus");l&&l.focus&&l.focus(),w.$broadcast("ngDialog.closing",e,t),p=0>p?0:p,a&&!n.disableAnimation?(s.$destroy(),e.unbind(o).bind(o,function(){A.closeDialogElement(e,t)}).addClass("ngdialog-closing")):(s.$destroy(),A.closeDialogElement(e,t)),h[i]&&(h[i].resolve({id:i,value:t,$dialog:e,remainingDialogs:p}),delete h[i]),c[i]&&delete c[i],m.splice(m.indexOf(i),1),m.length||(D.body.unbind("keydown",A.onDocumentKeydown),d=!1)}},closeDialogElement:function(e,t){e.remove(),0===p&&(D.html.removeClass("ngdialog-open"),D.body.removeClass("ngdialog-open"),A.resetBodyPadding()),w.$broadcast("ngDialog.closed",e,t)},closeDialog:function(t,n){var r=t.data("$ngDialogPreCloseCallback");if(r&&e.isFunction(r)){var i=r.call(t,n);e.isObject(i)?i.closePromise?i.closePromise.then(function(){A.performCloseDialog(t,n)}):i.then(function(){A.performCloseDialog(t,n)},function(){}):i!==!1&&A.performCloseDialog(t,n)}else A.performCloseDialog(t,n)},onTrapFocusKeydown:function(t){var n,r=e.element(t.currentTarget);if(r.hasClass("ngdialog"))n=r;else if(n=A.getActiveDialog(),null===n)return;var i=9===t.keyCode,a=t.shiftKey===!0;i&&A.handleTab(n,t,a)},handleTab:function(e,t,n){var r=A.getFocusableElements(e);if(0===r.length)return void(document.activeElement&&document.activeElement.blur());var i=document.activeElement,a=Array.prototype.indexOf.call(r,i),o=-1===a,s=0===a,u=a===r.length-1,l=!1;n?(o||s)&&(r[r.length-1].focus(),l=!0):(o||u)&&(r[0].focus(),l=!0),l&&(t.preventDefault(),t.stopPropagation())},autoFocus:function(e){var t=e[0],r=t.querySelector("*[autofocus]");if(null===r||(r.focus(),document.activeElement!==r)){var i=A.getFocusableElements(e);if(i.length>0)return void i[0].focus();var a=A.filterVisibleElements(t.querySelectorAll("h1,h2,h3,h4,h5,h6,p,span"));if(a.length>0){var o=a[0];n(o).attr("tabindex","-1").css("outline","0"),o.focus()}}},getFocusableElements:function(e){var t=e[0],n=t.querySelectorAll(s),r=A.filterTabbableElements(n);return A.filterVisibleElements(r)},filterTabbableElements:function(e){for(var t=[],r=0;r<e.length;r++){var i=e[r];"-1"!==n(i).attr("tabindex")&&t.push(i)}return t},filterVisibleElements:function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];(r.offsetWidth>0||r.offsetHeight>0)&&t.push(r)}return t},getActiveDialog:function(){var e=document.querySelectorAll(".ngdialog");return 0===e.length?null:n(e[e.length-1])},applyAriaAttributes:function(e,t){if(t.ariaAuto){if(!t.ariaRole){var n=A.getFocusableElements(e).length>0?"dialog":"alertdialog";t.ariaRole=n}t.ariaLabelledBySelector||(t.ariaLabelledBySelector="h1,h2,h3,h4,h5,h6"),t.ariaDescribedBySelector||(t.ariaDescribedBySelector="article,section,p")}t.ariaRole&&e.attr("role",t.ariaRole),A.applyAriaAttribute(e,"aria-labelledby",t.ariaLabelledById,t.ariaLabelledBySelector),A.applyAriaAttribute(e,"aria-describedby",t.ariaDescribedById,t.ariaDescribedBySelector)},applyAriaAttribute:function(e,t,r,i){if(r&&e.attr(t,r),i){var a=e.attr("id"),o=e[0].querySelector(i);if(!o)return;var s=a+"-"+t;return n(o).attr("id",s),e.attr(t,s),s}},detectUIRouter:function(){try{return e.module("ui.router"),!0}catch(t){return!1}},getRouterLocationEventName:function(){return A.detectUIRouter()?"$stateChangeSuccess":"$locationChangeSuccess"}},k={__PRIVATE__:A,open:function(a){function o(e,t){return w.$broadcast("ngDialog.templateLoading",e),$.get(e,t||{}).then(function(t){return w.$broadcast("ngDialog.templateLoaded",e),t.data||""})}function s(t){return t?e.isString(t)&&g.plain?t:"boolean"!=typeof g.cache||g.cache?o(t,{cache:v}):o(t,{cache:!1}):"Empty template"}var l=null;if(a=a||{},!(f&&a.name&&(l=a.name+" dialog",this.isOpen(l)))){var g=e.copy(t),M=++i;l=l||"ngdialog"+M,m.push(l),e.extend(g,a);var E;h[l]=E=y.defer();var T;c[l]=T=e.isObject(g.scope)?g.scope.$new():w.$new();var _,q,N=e.extend({},g.resolve);return e.forEach(N,function(t,n){N[n]=e.isString(t)?S.get(t):S.invoke(t,null,null,n)}),y.all({template:s(g.template||g.templateUrl),locals:y.all(N)}).then(function(t){var i=t.template,a=t.locals;g.showClose&&(i+='<div class="ngdialog-close"></div>');var o=g.overlay?"":" ngdialog-no-overlay";if(_=n('<div id="'+l+'" class="ngdialog'+o+'"></div>'),_.html(g.overlay?'<div class="ngdialog-overlay"></div><div class="ngdialog-content" role="document">'+i+"</div>":'<div class="ngdialog-content" role="document">'+i+"</div>"),_.data("$ngDialogOptions",g),T.ngDialogId=l,g.data&&e.isString(g.data)){var s=g.data.replace(/^\s*/,"")[0];T.ngDialogData="{"===s||"["===s?e.fromJson(g.data):g.data,T.ngDialogData.ngDialogId=l}else g.data&&e.isObject(g.data)&&(T.ngDialogData=g.data,T.ngDialogData.ngDialogId=l);if(g.className&&_.addClass(g.className),g.disableAnimation&&_.addClass(u),q=g.appendTo&&e.isString(g.appendTo)?e.element(document.querySelector(g.appendTo)):D.body,A.applyAriaAttributes(_,g),g.preCloseCallback){var c;e.isFunction(g.preCloseCallback)?c=g.preCloseCallback:e.isString(g.preCloseCallback)&&T&&(e.isFunction(T[g.preCloseCallback])?c=T[g.preCloseCallback]:T.$parent&&e.isFunction(T.$parent[g.preCloseCallback])?c=T.$parent[g.preCloseCallback]:w&&e.isFunction(w[g.preCloseCallback])&&(c=w[g.preCloseCallback])),c&&_.data("$ngDialogPreCloseCallback",c)}if(T.closeThisDialog=function(e){A.closeDialog(_,e)},g.controller&&(e.isString(g.controller)||e.isArray(g.controller)||e.isFunction(g.controller))){var m;g.controllerAs&&e.isString(g.controllerAs)&&(m=g.controllerAs);var f=j(g.controller,e.extend(a,{$scope:T,$element:_}),!0,m);g.bindToController&&e.extend(f.instance,{ngDialogId:T.ngDialogId,ngDialogData:T.ngDialogData,closeThisDialog:T.closeThisDialog}),_.data("$ngDialogControllerController",f())}if(x(function(){var e=document.querySelectorAll(".ngdialog");A.deactivateAll(e),b(_)(T);var t=C.innerWidth-D.body.prop("clientWidth");D.html.addClass("ngdialog-open"),D.body.addClass("ngdialog-open");var n=t-(C.innerWidth-D.body.prop("clientWidth"));n>0&&A.setBodyPadding(n),q.append(_),A.activate(_),g.trapFocus&&A.autoFocus(_),g.name?w.$broadcast("ngDialog.opened",{dialog:_,name:g.name}):w.$broadcast("ngDialog.opened",_)}),d||(D.body.bind("keydown",A.onDocumentKeydown),d=!0),g.closeByNavigation){var h=A.getRouterLocationEventName();w.$on(h,function(){A.closeDialog(_)})}if(g.preserveFocus&&_.data("$ngDialogPreviousFocus",document.activeElement),r=function(e){var t=g.closeByDocument?n(e.target).hasClass("ngdialog-overlay"):!1,r=n(e.target).hasClass("ngdialog-close");(t||r)&&k.close(_.attr("id"),r?"$closeButton":"$document")},"undefined"!=typeof C.Hammer){var v=T.hammerTime=C.Hammer(_[0]);v.on("tap",r)}else _.bind("click",r);return p+=1,k}),{id:l,closePromise:E.promise,close:function(e){A.closeDialog(_,e)}}}},openConfirm:function(r){var i=y.defer(),a=e.copy(t);r=r||{},e.extend(a,r),a.scope=e.isObject(a.scope)?a.scope.$new():w.$new(),a.scope.confirm=function(e){i.resolve(e);var t=n(document.getElementById(o.id));A.performCloseDialog(t,e)};var o=k.open(a);return o?(o.closePromise.then(function(e){return e?i.reject(e.value):i.reject()}),i.promise):void 0},isOpen:function(e){var t=n(document.getElementById(e));return t.length>0},close:function(e,t){var r=n(document.getElementById(e));if(r.length)A.closeDialog(r,t);else if("$escape"===e){var i=m[m.length-1];r=n(document.getElementById(i)),r.data("$ngDialogOptions").closeByEscape&&A.closeDialog(r,"$escape")}else k.closeAll(t);return k},closeAll:function(e){for(var t=document.querySelectorAll(".ngdialog"),r=t.length-1;r>=0;r--){var i=t[r];A.closeDialog(n(i),e)}},getOpenDialogs:function(){return m},getDefaults:function(){return t}};return e.forEach(["html","body"],function(e){if(D[e]=g.find(e),l[e]){var t=A.getRouterLocationEventName();w.$on(t,function(){D[e]=g.find(e)})}}),k}]}),t.directive("ngDialog",["ngDialog",function(t){return{restrict:"A",scope:{ngDialogScope:"="},link:function(n,r,i){r.on("click",function(r){r.preventDefault();var a=e.isDefined(n.ngDialogScope)?n.ngDialogScope:"noScope";e.isDefined(i.ngDialogClosePrevious)&&t.close(i.ngDialogClosePrevious);var o=t.getDefaults();t.open({template:i.ngDialog,className:i.ngDialogClass||o.className,controller:i.ngDialogController,controllerAs:i.ngDialogControllerAs,bindToController:i.ngDialogBindToController,scope:a,data:i.ngDialogData,showClose:"false"===i.ngDialogShowClose?!1:"true"===i.ngDialogShowClose?!0:o.showClose,closeByDocument:"false"===i.ngDialogCloseByDocument?!1:"true"===i.ngDialogCloseByDocument?!0:o.closeByDocument,closeByEscape:"false"===i.ngDialogCloseByEscape?!1:"true"===i.ngDialogCloseByEscape?!0:o.closeByEscape,overlay:"false"===i.ngDialogOverlay?!1:"true"===i.ngDialogOverlay?!0:o.overlay,preCloseCallback:i.ngDialogPreCloseCallback||o.preCloseCallback})})}}}]),t});
